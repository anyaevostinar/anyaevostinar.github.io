<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Starting with Flask | Anya E. Vostinar</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Starting with Flask" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The homepage of Prof. Anya E. Vostinar. I teach computer science and research the evolution of symbiosis using digital evolution and agent-based modeling. I wrote the Symbulation platform." />
<meta property="og:description" content="The homepage of Prof. Anya E. Vostinar. I teach computer science and research the evolution of symbiosis using digital evolution and agent-based modeling. I wrote the Symbulation platform." />
<link rel="canonical" href="http://localhost:4000/classes/257-f23/flask-intro" />
<meta property="og:url" content="http://localhost:4000/classes/257-f23/flask-intro" />
<meta property="og:site_name" content="Anya E. Vostinar" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Starting with Flask" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"The homepage of Prof. Anya E. Vostinar. I teach computer science and research the evolution of symbiosis using digital evolution and agent-based modeling. I wrote the Symbulation platform.","headline":"Starting with Flask","url":"http://localhost:4000/classes/257-f23/flask-intro"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Anya E. Vostinar" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Anya E. Vostinar</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/Classes/">Classes</a><a class="page-link" href="/Research/">Research</a><a class="page-link" href="/blog/">Blog</a><a class="page-link" href="/About/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Starting with Flask</h1>
  </header>

  <div class="post-content">
    <h2 id="goal">Goal</h2>
<p>Get started with Flask by making the simplest app.</p>

<h2 id="setup">Setup</h2>
<p>If you are doing this on your personal machine and have Flask installed, great.</p>

<p>If you don’t have Flask installed yet, go back to the reading for today and do that.</p>

<p>If you have trouble installing Flask on your personal machine, you can use a lab machine.</p>

<p>If you are using a lab machine, you’re good, Flask is already installed.</p>

<h2 id="getting-started">Getting Started</h2>
<p>As you know from the reading, Flask is a web framework that lets you build dynamic a dynamic website using Python.
You’re first going to build a very simple app that grabs data from a file and displays it on dynamically-built (and ugly) web pages.</p>

<ol>
  <li>Make a new folder <code class="language-plaintext highlighter-rouge">FlaskLab</code> and open it in VSCode</li>
  <li>Make a new file <code class="language-plaintext highlighter-rouge">flask_lab_app.py</code></li>
  <li>In that file, put the boilerplate for Flask apps:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

 <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

 <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
     <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>As you know from your reading, Flask allows you to mark which function should be called when a user goes to a specific URL, so start by making a <code class="language-plaintext highlighter-rouge">homepage()</code> function that is called when a user first goes to your website using <code class="language-plaintext highlighter-rouge">@app.route('/')</code> (feel free to make the string returned more exciting):
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">homepage</span><span class="p">():</span>
     <span class="k">return</span> <span class="s">"hello, this is the homepage"</span>
</code></pre></div>    </div>
  </li>
  <li>Open up the Terminal in VSCode and run your python script as you normally would:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> python3 flask_lab_app.py
</code></pre></div>    </div>

    <p>You should see something like:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">*</span> Serving Flask app <span class="s1">'app'</span> <span class="o">(</span>lazy loading<span class="o">)</span>
 <span class="k">*</span> Environment: production
   WARNING: This is a development server. Do not use it <span class="k">in </span>a production deployment.
  Use a production WSGI server instead.
 <span class="k">*</span> Debug mode: off
 <span class="k">*</span> Running on http://127.0.0.1:5000/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
</code></pre></div>    </div>

    <p>And if you copy and paste that web address (the thing that starts with <code class="language-plaintext highlighter-rouge">http</code>) and put it into your web browser of choice, you should see your message. Congrats, you made a website with a Flask!</p>
  </li>
</ol>

<h2 id="outputting-data">Outputting Data</h2>
<p>The main goal of using Flask is that we are able to display data from your dataset onto your website.
Eventually, we’ll put your data into a database, but for now, we’ll stick with loading it in from a file so we can focus on how Flask itself works.</p>

<ol>
  <li>Download <a href="/classes/257-f23/dataset.csv">this</a> very exciting dataset (it’s not exciting, sorry) and put it into the folder with your flask app python file</li>
  <li>We’re going to keep things simple by just making a global variable <code class="language-plaintext highlighter-rouge">data</code> and saving the dataset into that:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

 <span class="k">def</span> <span class="nf">load_data</span><span class="p">():</span>
     <span class="c1">#slightly weird syntax for reading from a file, but apparently the proper Pythonic way:
</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'dataset.csv'</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">''</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
         <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
             <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Now there are a lot of choices for how to display this data, though a common mistake is to not have the function return a string. We’ll start by thinking of your command line arguments as being entered in the URL. If you wanted to let the user get a particular cell of your dataset, you could make the decorator for the function include the desired row and column as variables:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/&lt;row&gt;/&lt;column&gt;'</span><span class="p">,</span> <span class="n">strict_slashes</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>The <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> indicate that the string inside them should be a variable that is passed to your associated function, which also means that the function has to take those arguments, like so:</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">def</span> <span class="nf">get_cell</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
</code></pre></div>    </div>

    <p>Use those two snippets to complete the <code class="language-plaintext highlighter-rouge">get_cell</code> function so that you can go to the page <code class="language-plaintext highlighter-rouge">your_url/0/1</code> and see a page with <code class="language-plaintext highlighter-rouge">column_2</code> on it.</p>

    <p>You can also try letting the user get an entire row of the dataset, but remember that you’ll need to turn the list into a string to do so.</p>
  </li>
</ol>

<h2 id="handling-user-errors-and-your-own">Handling user errors (and your own)</h2>

<p>You may have noticed as you were doing the previous pieces that it would be nice if you could achieve something similar to a usage statement.
Fun fact, you can!</p>

<ol>
  <li>Add a function with the decorator <code class="language-plaintext highlighter-rouge">@app.errorhandler(404)</code> to catch page not found errors. The function will need to take an argument (which is the error):
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
     <span class="k">return</span> <span class="s">"sorry, wrong format, do this instead...."</span>
</code></pre></div>    </div>

    <p>Make sure that the function lets the user know what format they should use for the URL to get the information they want.</p>
  </li>
  <li>You can add a function for internal server errors as well, i.e. when you have a bug in your Python code:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
 <span class="k">def</span> <span class="nf">python_bug</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
     <span class="k">return</span> <span class="s">"Eek, a bug!"</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="testing">Testing</h2>
<p>You can test the Flask-specific functions the normal way by just calling them directly and checking that they return the correct thing.
You can also test that your Flask app returns the correct thing based on a URL with the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">class</span> <span class="nc">TestSOMETHING</span><span class="p">(</span><span class="n">unittest</span><span class="p">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="sa">b</span><span class="s">'hello, this is the homepage'</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">b</code> stands for byte and its because <code class="language-plaintext highlighter-rouge">response.data</code> is a ‘bytes-like object’.
Once you make more complicated pages, you can use <code class="language-plaintext highlighter-rouge">assertIn</code> to check for the specific data that you care about without worrying about the HTML tags.</p>

<p>Make a test file and test your existing functions and routes. (Yes, we’re breaking TDD since we already have the production code written. It’d be a good idea to purposefully break your production code to make sure your tests fail first.)</p>

<p><em>Acknowledgements: I adapted code from <a href="https://www.patricksoftwareblog.com/unit-testing-a-flask-application/">this guide</a> for this section. Check there if you’re curious about more advanced testing.</em></p>

<h2 id="applying-to-your-project">Applying to your project</h2>
<p>You’re now all set to turn your command-line interface project into a Flask app.
It’s good to separate the underlying logic of your program from the Flask-specific portion so that it will be easier to refactor the logic portion once we add a database.
Therefore, you should have all the Flask functionality in a separate file that imports the file with core functions.
You should now start on your <a href="project-2-ind">individual deliverable</a> for this week, which is making a Flask app with a homepage and single data route, and is due <strong>Friday evening</strong>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Anya E. Vostinar</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Anya E. Vostinar</li><li><a class="u-email" href="mailto:vostinar@carleton.edu">vostinar@carleton.edu</a></li><li><a class="u-email" href="https://linktr.ee/vostinar">https://linktr.ee/vostinar</a></li>
            Note that this website uses Google Analytics to collect and analyze usage.
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anyaevostinar"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anyaevostinar</span></a></li><li><a href="https://www.twitter.com/AnyaEVostinar"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">AnyaEVostinar</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>The homepage of Prof. Anya E. Vostinar. I teach computer science and research the evolution of  symbiosis using digital evolution and agent-based modeling. I wrote the Symbulation platform.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
